+ set -e
+ LOG_DIR=20220907b
+ JOBS=4
+ CLIENTS=16
+ DURATION_RO=900
+ DURATION_RW=3600
+ RUNS_RO=1
+ RUNS_RW=1
+ MOUNTDIR=/mnt/data
+ DATADIR=/mnt/data/pgdata
+ for level in 1 10 5 6
+ pgconf=default
+ for fs in xfs ext4
+ TESTDIR=20220907b/1/xfs
+ '[' -d 20220907b/1/xfs ']'
+ mkdir -p 20220907b/1/xfs
+ CSV='1;default;xfs'
+ echo '===== default 1 xfs ====='
===== default 1 xfs =====
+ l=1
+ '[' 1 == 0 ']'
+ '[' 1 == 1 ']'
+ d=3
+ sudo mdadm --zero-superblock --force /dev/sda1
+ sudo mdadm --zero-superblock --force /dev/sdb1
+ sudo mdadm --zero-superblock --force /dev/sdc1
+ sudo mdadm --zero-superblock --force /dev/sdd1
+ sudo mdadm --zero-superblock --force /dev/sde1
+ sudo mdadm --zero-superblock --force /dev/sdf1
+ sudo mdadm --create -R --verbose /dev/md0 --chunk=64K --level=1 --raid-devices=6 /dev/sda1 /dev/sdb1 /dev/sdc1 /dev/sdd1 /dev/sde1 /dev/sdf1
mdadm: chunk size ignored for this level
mdadm: Note: this array has metadata at the start and
    may not be suitable as a boot device.  If you plan to
    store '/boot' on this device please ensure that
    your boot-loader understands md/v1.x metadata, or use
    --metadata=0.90
mdadm: size set to 97618176K
mdadm: creation continuing despite oddities due to --run
mdadm: Defaulting to version 1.2 metadata
mdadm: array /dev/md0 started.
+ stride=16
+ stripe_width=48
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=0
+ '[' 0 == 0 ']'
+ break
+ '[' xfs == ext4 ']'
+ sudo mkfs.xfs -f -d su=64k,sw=3 /dev/md0
meta-data=/dev/md0               isize=512    agcount=16, agsize=1525280 blks
         =                       sectsz=4096  attr=2, projid32bit=1
         =                       crc=1        finobt=1, sparse=1, rmapbt=0
         =                       reflink=1    bigtime=0 inobtcount=0
data     =                       bsize=4096   blocks=24404480, imaxpct=25
         =                       sunit=16     swidth=48 blks
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal log           bsize=4096   blocks=11916, version=2
         =                       sectsz=4096  sunit=1 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
Discarding blocks...Done.
+ sleep 5
+ sudo mount -o relatime /dev/md0 /mnt/data
+ sudo chown postgres:postgres /mnt/data
+ pg_ctl -D /mnt/data/pgdata init
+ cp postgresql-default.conf /mnt/data/pgdata/postgresql.conf
+ pg_ctl -D /mnt/data/pgdata -l 20220907b/1/xfs/pg.log -w start
waiting for server to start.... done
server started
+ ps ax
+ pg_config
+ psql postgres -c 'select * from pg_settings'
+ sudo mdadm --detail /dev/md0
+ for scale in 50 250 1000
+ dropdb --if-exists test
NOTICE:  database "test" does not exist, skipping
+ createdb test
+ mkdir 20220907b/1/xfs/50
++ date +%s
+ t1=1662575640
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662575640.407071
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=0/18810A8
+ pgbench -i -s 50 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662575640.407071'
+ d=13.414653
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''0/18810A8'\'')'
+ w=644061736
++ date +%s
+ t2=1662575653
+ echo '1662575640;1662575653;1;default;xfs;50;init;13.414653;644061736'
++ date +%s
+ t1=1662575653
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662575653.829096
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=0/27EBAAD0
+ vacuumdb --freeze --min-xid-age=1 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662575653.829096'
+ d=0.025374
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''0/27EBAAD0'\'')'
+ w=62768
++ date +%s
+ t2=1662575653
+ echo '1662575653;1662575653;1;default;xfs;50;vacuum;0.025374;62768'
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RO`
+ '[' 50 == 50 ']'
+ continue
+ psql test -c checkpoint
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RW`
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/1/xfs/50/run-rw-1
++ date +%s
+ t1=1662575657
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=671793152
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=112386048
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=791614267
+ echo 'before;671793152;112386048;791614267'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 3600 20220907b/1/xfs/50/run-rw-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662575657.236723
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=0/27ECA2D8
+ pgbench -n -M prepared -N -j 4 -c 16 -T 3600 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/1/xfs/50/run-rw-1/pgbench_log.tgz pgbench_log.6506 pgbench_log.6506.1 pgbench_log.6506.2 pgbench_log.6506.3
+ rm -f pgbench_log.6506 pgbench_log.6506.1 pgbench_log.6506.2 pgbench_log.6506.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662575657.236723'
+ d=3601.188755
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''0/27ECA2D8'\'')'
+ w=19914528552
++ date +%s
+ t2=1662579258
++ cat 20220907b/1/xfs/50/run-rw-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=17867.030819
+ echo '1662575657;1662579258;1;default;xfs;50;rw;17867.030819;3601.188755;19914528552'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=4059537408
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=112386048
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=4179366715
+ echo 'after;4059537408;112386048;4179366715'
+ sleep 60
+ for scale in 50 250 1000
+ dropdb --if-exists test
+ createdb test
+ mkdir 20220907b/1/xfs/250
++ date +%s
+ t1=1662579319
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662579319.010239
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=4/CB2B5F40
+ pgbench -i -s 250 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662579319.010239'
+ d=61.362474
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''4/CB2B5F40'\'')'
+ w=3220064104
++ date +%s
+ t2=1662579380
+ echo '1662579319;1662579380;1;default;xfs;250;init;61.362474;3220064104'
++ date +%s
+ t1=1662579380
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662579380.380201
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/8B19A6A8
+ vacuumdb --freeze --min-xid-age=1 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662579380.380201'
+ d=0.031282
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/8B19A6A8'\'')'
+ w=80216
++ date +%s
+ t2=1662579380
+ echo '1662579380;1662579380;1;default;xfs;250;vacuum;0.031282;80216'
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RO`
+ '[' 250 == 50 ']'
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/1/xfs/250/run-ro-1
++ date +%s
+ t1=1662579380
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3358531584
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3927683899
+ echo 'before;3358531584;561651712;3927683899'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 900 20220907b/1/xfs/250/run-ro-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662579380.441567
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/8B1AE000
+ pgbench -n -M prepared -S -j 4 -c 16 -T 900 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/1/xfs/250/run-ro-1/pgbench_log.tgz pgbench_log.28600 pgbench_log.28600.1 pgbench_log.28600.2 pgbench_log.28600.3
+ rm -f pgbench_log.28600 pgbench_log.28600.1 pgbench_log.28600.2 pgbench_log.28600.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662579380.441567'
+ d=901.443464
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/8B1AE000'\'')'
+ w=4416
++ date +%s
+ t2=1662580281
++ cat 20220907b/1/xfs/250/run-ro-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=97654.111297
+ echo '1662579380;1662580281;1;default;xfs;250;ro;97654.111297;901.443464;4416'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3358531584
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3927683899
+ echo 'after;3358531584;561651712;3927683899'
+ sleep 60
+ psql test -c checkpoint
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RW`
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/1/xfs/250/run-rw-1
++ date +%s
+ t1=1662580341
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3358531584
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3927683899
+ echo 'before;3358531584;561651712;3927683899'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 3600 20220907b/1/xfs/250/run-rw-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662580341.940715
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/8B1AF1F0
+ pgbench -n -M prepared -N -j 4 -c 16 -T 3600 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/1/xfs/250/run-rw-1/pgbench_log.tgz pgbench_log.1378 pgbench_log.1378.1 pgbench_log.1378.2 pgbench_log.1378.3
+ rm -f pgbench_log.1378 pgbench_log.1378.1 pgbench_log.1378.2 pgbench_log.1378.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662580341.940715'
+ d=3600.664091
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/8B1AF1F0'\'')'
+ w=24116283888
++ date +%s
+ t2=1662583942
++ cat 20220907b/1/xfs/250/run-rw-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=9420.083798
+ echo '1662580341;1662583942;1;default;xfs;250;rw;9420.083798;3600.664091;24116283888'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=5242920960
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=5812073275
+ echo 'after;5242920960;561651712;5812073275'
+ sleep 60
+ for scale in 50 250 1000
+ dropdb --if-exists test
+ createdb test
+ mkdir 20220907b/1/xfs/1000
++ date +%s
+ t1=1662584003
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662584003.371386
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=B/28CB1090
+ pgbench -i -s 1000 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662584003.371386'
+ d=278.994813
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''B/28CB1090'\'')'
+ w=12880076968
++ date +%s
+ t2=1662584282
+ echo '1662584003;1662584282;1;default;xfs;1000;init;278.994813;12880076968'
++ date +%s
+ t1=1662584282
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662584282.374497
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=E/28817138
+ vacuumdb --freeze --min-xid-age=1 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662584282.374497'
+ d=0.047975
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''E/28817138'\'')'
+ w=184008
++ date +%s
+ t2=1662584282
+ echo '1662584282;1662584282;1;default;xfs;1000;vacuum;0.047975;184008'
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RO`
+ '[' 1000 == 50 ']'
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/1/xfs/1000/run-ro-1
++ date +%s
+ t1=1662584282
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=13433806848
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=15687791419
+ echo 'before;13433806848;2246483968;15687791419'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 900 20220907b/1/xfs/1000/run-ro-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662584282.453550
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=E/28844000
+ pgbench -n -M prepared -S -j 4 -c 16 -T 900 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/1/xfs/1000/run-ro-1/pgbench_log.tgz pgbench_log.23553 pgbench_log.23553.1 pgbench_log.23553.2 pgbench_log.23553.3
+ rm -f pgbench_log.23553 pgbench_log.23553.1 pgbench_log.23553.2 pgbench_log.23553.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662584282.453550'
+ d=900.892243
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''E/28844000'\'')'
+ w=5056
++ date +%s
+ t2=1662585183
++ cat 20220907b/1/xfs/1000/run-ro-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=59055.078255
+ echo '1662584282;1662585183;1;default;xfs;1000;ro;59055.078255;900.892243;5056'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=13433806848
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=15687791419
+ echo 'after;13433806848;2246483968;15687791419'
+ sleep 60
+ psql test -c checkpoint
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RW`
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/1/xfs/1000/run-rw-1
++ date +%s
+ t1=1662585243
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=13433806848
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=15687791419
+ echo 'before;13433806848;2246483968;15687791419'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 3600 20220907b/1/xfs/1000/run-rw-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662585243.410895
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=E/28845470
+ pgbench -n -M prepared -N -j 4 -c 16 -T 3600 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/1/xfs/1000/run-rw-1/pgbench_log.tgz pgbench_log.29053 pgbench_log.29053.1 pgbench_log.29053.2 pgbench_log.29053.3
+ rm -f pgbench_log.29053 pgbench_log.29053.1 pgbench_log.29053.2 pgbench_log.29053.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662585243.410895'
+ d=3600.358996
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''E/28845470'\'')'
+ w=52620923528
++ date +%s
+ t2=1662588843
++ cat 20220907b/1/xfs/1000/run-rw-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=3541.419260
+ echo '1662585243;1662588843;1;default;xfs;1000;rw;3541.419260;3600.358996;52620923528'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=14323073024
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=16577057595
+ echo 'after;14323073024;2246483968;16577057595'
+ sleep 60
+ pg_ctl -D /mnt/data/pgdata -l 20220907b/1/xfs/pg.log -w -m immediate -t 3600 stop
waiting for server to shut down.... done
server stopped
+ sudo umount /mnt/data
+ sudo mdadm --stop /dev/md0
mdadm: stopped /dev/md0
+ for fs in xfs ext4
+ TESTDIR=20220907b/1/ext4
+ '[' -d 20220907b/1/ext4 ']'
+ mkdir -p 20220907b/1/ext4
+ CSV='1;default;ext4'
+ echo '===== default 1 ext4 ====='
===== default 1 ext4 =====
+ l=1
+ '[' 1 == 0 ']'
+ '[' 1 == 1 ']'
+ d=3
+ sudo mdadm --zero-superblock --force /dev/sda1
+ sudo mdadm --zero-superblock --force /dev/sdb1
+ sudo mdadm --zero-superblock --force /dev/sdc1
+ sudo mdadm --zero-superblock --force /dev/sdd1
+ sudo mdadm --zero-superblock --force /dev/sde1
+ sudo mdadm --zero-superblock --force /dev/sdf1
+ sudo mdadm --create -R --verbose /dev/md0 --chunk=64K --level=1 --raid-devices=6 /dev/sda1 /dev/sdb1 /dev/sdc1 /dev/sdd1 /dev/sde1 /dev/sdf1
mdadm: chunk size ignored for this level
mdadm: Note: this array has metadata at the start and
    may not be suitable as a boot device.  If you plan to
    store '/boot' on this device please ensure that
    your boot-loader understands md/v1.x metadata, or use
    --metadata=0.90
mdadm: size set to 97618176K
mdadm: creation continuing despite oddities due to --run
mdadm: Defaulting to version 1.2 metadata
mdadm: array /dev/md0 started.
+ stride=16
+ stripe_width=48
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=0
+ '[' 0 == 0 ']'
+ break
+ '[' ext4 == ext4 ']'
+ sudo mkfs.ext4 -F -E stride=16,stripe_width=48 /dev/md0
mke2fs 1.46.5 (30-Dec-2021)
Discarding device blocks:        0/24404544 1572864/24404544 4194304/24404544 7340032/2440454410485760/2440454413107200/2440454416252928/2440454419398656/2440454422020096/24404544                 done                            
Creating filesystem with 24404544 4k blocks and 6103040 inodes
Filesystem UUID: de62559c-3b63-4bd5-bb44-215482c4b046
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
	4096000, 7962624, 11239424, 20480000, 23887872

Allocating group tables:   0/745       done                            
Writing inode tables:   0/745       done                            
Creating journal (131072 blocks): done
Writing superblocks and filesystem accounting information:   0/745       done

+ sleep 5
+ sudo mount -o relatime /dev/md0 /mnt/data
+ sudo chown postgres:postgres /mnt/data
+ pg_ctl -D /mnt/data/pgdata init
+ cp postgresql-default.conf /mnt/data/pgdata/postgresql.conf
+ pg_ctl -D /mnt/data/pgdata -l 20220907b/1/ext4/pg.log -w start
waiting for server to start.... done
server started
+ ps ax
+ pg_config
+ psql postgres -c 'select * from pg_settings'
+ sudo mdadm --detail /dev/md0
+ for scale in 50 250 1000
+ dropdb --if-exists test
NOTICE:  database "test" does not exist, skipping
+ createdb test
+ mkdir 20220907b/1/ext4/50
++ date +%s
+ t1=1662589482
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662589482.819066
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=0/18810A8
+ pgbench -i -s 50 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662589482.819066'
+ d=14.133703
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''0/18810A8'\'')'
+ w=644061736
++ date +%s
+ t2=1662589496
+ echo '1662589482;1662589496;1;default;ext4;50;init;14.133703;644061736'
++ date +%s
+ t1=1662589496
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662589496.961158
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=0/27EBAAD0
+ vacuumdb --freeze --min-xid-age=1 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662589496.961158'
+ d=0.027489
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''0/27EBAAD0'\'')'
+ w=62768
++ date +%s
+ t2=1662589496
+ echo '1662589496;1662589496;1;default;ext4;50;vacuum;0.027489;62768'
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RO`
+ '[' 50 == 50 ']'
+ continue
+ psql test -c checkpoint
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RW`
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/1/ext4/50/run-rw-1
++ date +%s
+ t1=1662589499
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=671793152
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=112386048
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=791614267
+ echo 'before;671793152;112386048;791614267'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 3600 20220907b/1/ext4/50/run-rw-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662589499.930324
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=0/27ECA2D8
+ pgbench -n -M prepared -N -j 4 -c 16 -T 3600 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/1/ext4/50/run-rw-1/pgbench_log.tgz pgbench_log.19233 pgbench_log.19233.1 pgbench_log.19233.2 pgbench_log.19233.3
+ rm -f pgbench_log.19233 pgbench_log.19233.1 pgbench_log.19233.2 pgbench_log.19233.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662589499.930324'
+ d=3601.158937
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''0/27ECA2D8'\'')'
+ w=20198164544
++ date +%s
+ t2=1662593101
++ cat 20220907b/1/ext4/50/run-rw-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=18211.758239
+ echo '1662589499;1662593101;1;default;ext4;50;rw;18211.758239;3601.158937;20198164544'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=4125179904
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=112386048
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=4245009211
+ echo 'after;4125179904;112386048;4245009211'
+ sleep 60
+ for scale in 50 250 1000
+ dropdb --if-exists test
+ createdb test
+ mkdir 20220907b/1/ext4/250
++ date +%s
+ t1=1662593161
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662593161.754569
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=4/DC132870
+ pgbench -i -s 250 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662593161.754569'
+ d=61.267753
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''4/DC132870'\'')'
+ w=3220063928
++ date +%s
+ t2=1662593223
+ echo '1662593161;1662593223;1;default;ext4;250;init;61.267753;3220063928'
++ date +%s
+ t1=1662593223
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662593223.030754
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/9C016F28
+ vacuumdb --freeze --min-xid-age=1 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662593223.030754'
+ d=0.032818
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/9C016F28'\'')'
+ w=78040
++ date +%s
+ t2=1662593223
+ echo '1662593223;1662593223;1;default;ext4;250;vacuum;0.032818;78040'
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RO`
+ '[' 250 == 50 ']'
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/1/ext4/250/run-ro-1
++ date +%s
+ t1=1662593223
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3358531584
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3927683899
+ echo 'before;3358531584;561651712;3927683899'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 900 20220907b/1/ext4/250/run-ro-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662593223.095450
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/9C02A000
+ pgbench -n -M prepared -S -j 4 -c 16 -T 900 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/1/ext4/250/run-ro-1/pgbench_log.tgz pgbench_log.8821 pgbench_log.8821.1 pgbench_log.8821.2 pgbench_log.8821.3
+ rm -f pgbench_log.8821 pgbench_log.8821.1 pgbench_log.8821.2 pgbench_log.8821.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662593223.095450'
+ d=901.469135
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/9C02A000'\'')'
+ w=6592
++ date +%s
+ t2=1662594124
++ cat 20220907b/1/ext4/250/run-ro-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=99589.751353
+ echo '1662593223;1662594124;1;default;ext4;250;ro;99589.751353;901.469135;6592'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3358531584
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3927683899
+ echo 'after;3358531584;561651712;3927683899'
+ sleep 60
+ psql test -c checkpoint
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RW`
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/1/ext4/250/run-rw-1
++ date +%s
+ t1=1662594184
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3358531584
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3927683899
+ echo 'before;3358531584;561651712;3927683899'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 3600 20220907b/1/ext4/250/run-rw-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662594184.620716
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/9C02BA70
+ pgbench -n -M prepared -N -j 4 -c 16 -T 3600 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/1/ext4/250/run-rw-1/pgbench_log.tgz pgbench_log.14023 pgbench_log.14023.1 pgbench_log.14023.2 pgbench_log.14023.3
+ rm -f pgbench_log.14023 pgbench_log.14023.1 pgbench_log.14023.2 pgbench_log.14023.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662594184.620716'
+ d=3600.686507
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/9C02BA70'\'')'
+ w=24254990424
++ date +%s
+ t2=1662597785
++ cat 20220907b/1/ext4/250/run-rw-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=9596.235703
+ echo '1662594184;1662597785;1;default;ext4;250;rw;9596.235703;3600.686507;24254990424'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=5275525120
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=5844677435
+ echo 'after;5275525120;561651712;5844677435'
+ sleep 60
+ for scale in 50 250 1000
+ dropdb --if-exists test
+ createdb test
+ mkdir 20220907b/1/ext4/1000
++ date +%s
+ t1=1662597846
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662597846.324884
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=B/41F75758
+ pgbench -i -s 1000 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662597846.324884'
+ d=281.714254
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''B/41F75758'\'')'
+ w=12880077064
++ date +%s
+ t2=1662598128
+ echo '1662597846;1662598128;1;default;ext4;1000;init;281.714254;12880077064'
++ date +%s
+ t1=1662598128
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662598128.050504
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=E/41ADB860
+ vacuumdb --freeze --min-xid-age=1 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662598128.050504'
+ d=0.066449
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''E/41ADB860'\'')'
+ w=182176
++ date +%s
+ t2=1662598128
+ echo '1662598128;1662598128;1;default;ext4;1000;vacuum;0.066449;182176'
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RO`
+ '[' 1000 == 50 ']'
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/1/ext4/1000/run-ro-1
++ date +%s
+ t1=1662598128
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=13433806848
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=15687791419
+ echo 'before;13433806848;2246483968;15687791419'
++ ps ax
++ grep collect-stats
++ wc -l
++ grep -v grep
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 900 20220907b/1/ext4/1000/run-ro-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662598128.158382
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=E/41B08000
+ pgbench -n -M prepared -S -j 4 -c 16 -T 900 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/1/ext4/1000/run-ro-1/pgbench_log.tgz pgbench_log.3632 pgbench_log.3632.1 pgbench_log.3632.2 pgbench_log.3632.3
+ rm -f pgbench_log.3632 pgbench_log.3632.1 pgbench_log.3632.2 pgbench_log.3632.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662598128.158382'
+ d=900.909820
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''E/41B08000'\'')'
+ w=6888
++ date +%s
+ t2=1662599029
++ cat 20220907b/1/ext4/1000/run-ro-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=59368.655897
+ echo '1662598128;1662599029;1;default;ext4;1000;ro;59368.655897;900.909820;6888'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=13433806848
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=15687791419
+ echo 'after;13433806848;2246483968;15687791419'
+ sleep 60
+ psql test -c checkpoint
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RW`
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/1/ext4/1000/run-rw-1
++ date +%s
+ t1=1662599089
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=13433806848
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=15687791419
+ echo 'before;13433806848;2246483968;15687791419'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 3600 20220907b/1/ext4/1000/run-rw-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662599089.134963
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=E/41B09B98
+ pgbench -n -M prepared -N -j 4 -c 16 -T 3600 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/1/ext4/1000/run-rw-1/pgbench_log.tgz pgbench_log.9158 pgbench_log.9158.1 pgbench_log.9158.2 pgbench_log.9158.3
+ rm -f pgbench_log.9158 pgbench_log.9158.1 pgbench_log.9158.2 pgbench_log.9158.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662599089.134963'
+ d=3600.347132
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''E/41B09B98'\'')'
+ w=52568799640
++ date +%s
+ t2=1662602689
++ cat 20220907b/1/ext4/1000/run-rw-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=3531.744230
+ echo '1662599089;1662602689;1;default;ext4;1000;rw;3531.744230;3600.347132;52568799640'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=14321729536
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=16575714107
+ echo 'after;14321729536;2246483968;16575714107'
+ sleep 60
+ pg_ctl -D /mnt/data/pgdata -l 20220907b/1/ext4/pg.log -w -m immediate -t 3600 stop
waiting for server to shut down.... done
server stopped
+ sudo umount /mnt/data
+ sudo mdadm --stop /dev/md0
mdadm: stopped /dev/md0
+ for level in 1 10 5 6
+ pgconf=default
+ for fs in xfs ext4
+ TESTDIR=20220907b/10/xfs
+ '[' -d 20220907b/10/xfs ']'
+ mkdir -p 20220907b/10/xfs
+ CSV='10;default;xfs'
+ echo '===== default 10 xfs ====='
===== default 10 xfs =====
+ l=10
+ '[' 10 == 0 ']'
+ '[' 10 == 1 ']'
+ '[' 10 == 10 ']'
+ d=3
+ sudo mdadm --zero-superblock --force /dev/sda1
+ sudo mdadm --zero-superblock --force /dev/sdb1
+ sudo mdadm --zero-superblock --force /dev/sdc1
+ sudo mdadm --zero-superblock --force /dev/sdd1
+ sudo mdadm --zero-superblock --force /dev/sde1
+ sudo mdadm --zero-superblock --force /dev/sdf1
+ sudo mdadm --create -R --verbose /dev/md0 --chunk=64K --level=10 --raid-devices=6 /dev/sda1 /dev/sdb1 /dev/sdc1 /dev/sdd1 /dev/sde1 /dev/sdf1
mdadm: layout defaults to n2
mdadm: layout defaults to n2
mdadm: size set to 97618176K
mdadm: Defaulting to version 1.2 metadata
mdadm: array /dev/md0 started.
+ stride=16
+ stripe_width=48
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ wc -l
++ grep resync /proc/mdstat
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=0
+ '[' 0 == 0 ']'
+ break
+ '[' xfs == ext4 ']'
+ sudo mkfs.xfs -f -d su=64k,sw=3 /dev/md0
meta-data=/dev/md0               isize=512    agcount=16, agsize=4575856 blks
         =                       sectsz=4096  attr=2, projid32bit=1
         =                       crc=1        finobt=1, sparse=1, rmapbt=0
         =                       reflink=1    bigtime=0 inobtcount=0
data     =                       bsize=4096   blocks=73213632, imaxpct=25
         =                       sunit=16     swidth=48 blks
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal log           bsize=4096   blocks=35748, version=2
         =                       sectsz=4096  sunit=1 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
Discarding blocks...Done.
+ sleep 5
+ sudo mount -o relatime /dev/md0 /mnt/data
+ sudo chown postgres:postgres /mnt/data
+ pg_ctl -D /mnt/data/pgdata init
+ cp postgresql-default.conf /mnt/data/pgdata/postgresql.conf
+ pg_ctl -D /mnt/data/pgdata -l 20220907b/10/xfs/pg.log -w start
waiting for server to start.... done
server started
+ ps ax
+ pg_config
+ psql postgres -c 'select * from pg_settings'
+ sudo mdadm --detail /dev/md0
+ for scale in 50 250 1000
+ dropdb --if-exists test
NOTICE:  database "test" does not exist, skipping
+ createdb test
+ mkdir 20220907b/10/xfs/50
++ date +%s
+ t1=1662604231
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662604231.585045
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=0/18810A8
+ pgbench -i -s 50 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662604231.585045'
+ d=7.855442
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''0/18810A8'\'')'
+ w=644061736
++ date +%s
+ t2=1662604239
+ echo '1662604231;1662604239;10;default;xfs;50;init;7.855442;644061736'
++ date +%s
+ t1=1662604239
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662604239.448827
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=0/27EBAAD0
+ vacuumdb --freeze --min-xid-age=1 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662604239.448827'
+ d=0.027221
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''0/27EBAAD0'\'')'
+ w=62768
++ date +%s
+ t2=1662604239
+ echo '1662604239;1662604239;10;default;xfs;50;vacuum;0.027221;62768'
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RO`
+ '[' 50 == 50 ']'
+ continue
+ psql test -c checkpoint
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RW`
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/10/xfs/50/run-rw-1
++ date +%s
+ t1=1662604240
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=671793152
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=112386048
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=791614267
+ echo 'before;671793152;112386048;791614267'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 3600 20220907b/10/xfs/50/run-rw-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662604240.593329
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=0/27ECA2A0
+ pgbench -n -M prepared -N -j 4 -c 16 -T 3600 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/10/xfs/50/run-rw-1/pgbench_log.tgz pgbench_log.495 pgbench_log.495.1 pgbench_log.495.2 pgbench_log.495.3
+ rm -f pgbench_log.495 pgbench_log.495.1 pgbench_log.495.2 pgbench_log.495.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662604240.593329'
+ d=3601.246115
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''0/27ECA2A0'\'')'
+ w=21494957144
++ date +%s
+ t2=1662607841
++ cat 20220907b/10/xfs/50/run-rw-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=19725.127717
+ echo '1662604240;1662607841;10;default;xfs;50;rw;19725.127717;3601.246115;21494957144'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=4409556992
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=112386048
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=4529386299
+ echo 'after;4409556992;112386048;4529386299'
+ sleep 60
+ for scale in 50 250 1000
+ dropdb --if-exists test
+ createdb test
+ mkdir 20220907b/10/xfs/250
++ date +%s
+ t1=1662607902
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662607902.400852
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/295EA480
+ pgbench -i -s 250 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662607902.400852'
+ d=37.039856
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/295EA480'\'')'
+ w=3220063752
++ date +%s
+ t2=1662607939
+ echo '1662607902;1662607939;10;default;xfs;250;init;37.039856;3220063752'
++ date +%s
+ t1=1662607939
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662607939.449004
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/E94CEA88
+ vacuumdb --freeze --min-xid-age=1 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662607939.449004'
+ d=0.031229
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/E94CEA88'\'')'
+ w=79224
++ date +%s
+ t2=1662607939
+ echo '1662607939;1662607939;10;default;xfs;250;vacuum;0.031229;79224'
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RO`
+ '[' 250 == 50 ']'
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/10/xfs/250/run-ro-1
++ date +%s
+ t1=1662607939
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3358531584
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3927683899
+ echo 'before;3358531584;561651712;3927683899'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 900 20220907b/10/xfs/250/run-ro-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662607939.511529
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/E94E2000
+ pgbench -n -M prepared -S -j 4 -c 16 -T 900 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/10/xfs/250/run-ro-1/pgbench_log.tgz pgbench_log.22547 pgbench_log.22547.1 pgbench_log.22547.2 pgbench_log.22547.3
+ rm -f pgbench_log.22547 pgbench_log.22547.1 pgbench_log.22547.2 pgbench_log.22547.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662607939.511529'
+ d=901.477747
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/E94E2000'\'')'
+ w=5464
++ date +%s
+ t2=1662608840
++ cat 20220907b/10/xfs/250/run-ro-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=101205.234070
+ echo '1662607939;1662608840;10;default;xfs;250;ro;101205.234070;901.477747;5464'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3358531584
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3927683899
+ echo 'after;3358531584;561651712;3927683899'
+ sleep 60
+ psql test -c checkpoint
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RW`
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/10/xfs/250/run-rw-1
++ date +%s
+ t1=1662608901
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3358531584
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3927683899
+ echo 'before;3358531584;561651712;3927683899'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 3600 20220907b/10/xfs/250/run-rw-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662608901.044557
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/E94E3608
+ pgbench -n -M prepared -N -j 4 -c 16 -T 3600 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/10/xfs/250/run-rw-1/pgbench_log.tgz pgbench_log.27743 pgbench_log.27743.1 pgbench_log.27743.2 pgbench_log.27743.3
+ rm -f pgbench_log.27743 pgbench_log.27743.1 pgbench_log.27743.2 pgbench_log.27743.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662608901.044557'
+ d=3600.966131
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/E94E3608'\'')'
+ w=28575799664
++ date +%s
+ t2=1662612502
++ cat 20220907b/10/xfs/250/run-rw-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=14651.653868
+ echo '1662608901;1662612502;10;default;xfs;250;rw;14651.653868;3600.966131;28575799664'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=6228205568
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=6797357883
+ echo 'after;6228205568;561651712;6797357883'
+ sleep 60
+ for scale in 50 250 1000
+ dropdb --if-exists test
+ createdb test
+ mkdir 20220907b/10/xfs/1000
++ date +%s
+ t1=1662612562
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662612562.788988
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=C/90CD2428
+ pgbench -i -s 1000 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662612562.788988'
+ d=155.454561
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''C/90CD2428'\'')'
+ w=12880076296
++ date +%s
+ t2=1662612718
+ echo '1662612562;1662612718;10;default;xfs;1000;init;155.454561;12880076296'
++ date +%s
+ t1=1662612718
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662612718.251991
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=F/90838230
+ vacuumdb --freeze --min-xid-age=1 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662612718.251991'
+ d=0.046825
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''F/90838230'\'')'
+ w=187856
++ date +%s
+ t2=1662612718
+ echo '1662612718;1662612718;10;default;xfs;1000;vacuum;0.046825;187856'
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RO`
+ '[' 1000 == 50 ']'
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/10/xfs/1000/run-ro-1
++ date +%s
+ t1=1662612718
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=13433806848
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=15687791419
+ echo 'before;13433806848;2246483968;15687791419'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 900 20220907b/10/xfs/1000/run-ro-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662612718.327799
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=F/90866000
+ pgbench -n -M prepared -S -j 4 -c 16 -T 900 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/10/xfs/1000/run-ro-1/pgbench_log.tgz pgbench_log.17364 pgbench_log.17364.1 pgbench_log.17364.2 pgbench_log.17364.3
+ rm -f pgbench_log.17364 pgbench_log.17364.1 pgbench_log.17364.2 pgbench_log.17364.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662612718.327799'
+ d=900.891199
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''F/90866000'\'')'
+ w=1208
++ date +%s
+ t2=1662613619
++ cat 20220907b/10/xfs/1000/run-ro-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=58010.330816
+ echo '1662612718;1662613619;10;default;xfs;1000;ro;58010.330816;900.891199;1208'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=13433806848
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=15687791419
+ echo 'after;13433806848;2246483968;15687791419'
+ sleep 60
+ psql test -c checkpoint
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RW`
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/10/xfs/1000/run-rw-1
++ date +%s
+ t1=1662613679
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=13433806848
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=15687791419
+ echo 'before;13433806848;2246483968;15687791419'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 3600 20220907b/10/xfs/1000/run-rw-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662613679.285032
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=F/90866568
+ pgbench -n -M prepared -N -j 4 -c 16 -T 3600 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/10/xfs/1000/run-rw-1/pgbench_log.tgz pgbench_log.22899 pgbench_log.22899.1 pgbench_log.22899.2 pgbench_log.22899.3
+ rm -f pgbench_log.22899 pgbench_log.22899.1 pgbench_log.22899.2 pgbench_log.22899.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662613679.285032'
+ d=3600.479904
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''F/90866568'\'')'
+ w=59334293272
++ date +%s
+ t2=1662617279
++ cat 20220907b/10/xfs/1000/run-rw-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=5820.318040
+ echo '1662613679;1662617279;10;default;xfs;1000;rw;5820.318040;3600.479904;59334293272'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=14751801344
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=17005785915
+ echo 'after;14751801344;2246483968;17005785915'
+ sleep 60
+ pg_ctl -D /mnt/data/pgdata -l 20220907b/10/xfs/pg.log -w -m immediate -t 3600 stop
waiting for server to shut down.... done
server stopped
+ sudo umount /mnt/data
+ sudo mdadm --stop /dev/md0
mdadm: stopped /dev/md0
+ for fs in xfs ext4
+ TESTDIR=20220907b/10/ext4
+ '[' -d 20220907b/10/ext4 ']'
+ mkdir -p 20220907b/10/ext4
+ CSV='10;default;ext4'
+ echo '===== default 10 ext4 ====='
===== default 10 ext4 =====
+ l=10
+ '[' 10 == 0 ']'
+ '[' 10 == 1 ']'
+ '[' 10 == 10 ']'
+ d=3
+ sudo mdadm --zero-superblock --force /dev/sda1
+ sudo mdadm --zero-superblock --force /dev/sdb1
+ sudo mdadm --zero-superblock --force /dev/sdc1
+ sudo mdadm --zero-superblock --force /dev/sdd1
+ sudo mdadm --zero-superblock --force /dev/sde1
+ sudo mdadm --zero-superblock --force /dev/sdf1
+ sudo mdadm --create -R --verbose /dev/md0 --chunk=64K --level=10 --raid-devices=6 /dev/sda1 /dev/sdb1 /dev/sdc1 /dev/sdd1 /dev/sde1 /dev/sdf1
mdadm: layout defaults to n2
mdadm: layout defaults to n2
mdadm: size set to 97618176K
mdadm: Defaulting to version 1.2 metadata
mdadm: array /dev/md0 started.
+ stride=16
+ stripe_width=48
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=1
+ '[' 1 == 0 ']'
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=0
+ '[' 0 == 0 ']'
+ break
+ '[' ext4 == ext4 ']'
+ sudo mkfs.ext4 -F -E stride=16,stripe_width=48 /dev/md0
mke2fs 1.46.5 (30-Dec-2021)
Discarding device blocks:        0/73213632 7864320/7321363217301504/7321363227787264/7321363237748736/7321363247710208/7321363257671680/7321363266584576/73213632                 done                            
Creating filesystem with 73213632 4k blocks and 18309120 inodes
Filesystem UUID: 89553d2b-8e25-4425-8e4f-e6f67bebf875
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
	4096000, 7962624, 11239424, 20480000, 23887872, 71663616

Allocating group tables:    0/2235         done                            
Writing inode tables:    0/2235         done                            
Creating journal (262144 blocks): done
Writing superblocks and filesystem accounting information:    0/2235         done

+ sleep 5
+ sudo mount -o relatime /dev/md0 /mnt/data
+ sudo chown postgres:postgres /mnt/data
+ pg_ctl -D /mnt/data/pgdata init
+ cp postgresql-default.conf /mnt/data/pgdata/postgresql.conf
+ pg_ctl -D /mnt/data/pgdata -l 20220907b/10/ext4/pg.log -w start
waiting for server to start.... done
server started
+ ps ax
+ pg_config
+ psql postgres -c 'select * from pg_settings'
+ sudo mdadm --detail /dev/md0
+ for scale in 50 250 1000
+ dropdb --if-exists test
NOTICE:  database "test" does not exist, skipping
+ createdb test
+ mkdir 20220907b/10/ext4/50
++ date +%s
+ t1=1662618822
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662618822.489513
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=0/18810A8
+ pgbench -i -s 50 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662618822.489513'
+ d=8.505325
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''0/18810A8'\'')'
+ w=644061736
++ date +%s
+ t2=1662618830
+ echo '1662618822;1662618830;10;default;ext4;50;init;8.505325;644061736'
++ date +%s
+ t1=1662618831
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662618831.003115
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=0/27EBAAD0
+ vacuumdb --freeze --min-xid-age=1 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662618831.003115'
+ d=0.027871
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''0/27EBAAD0'\'')'
+ w=62768
++ date +%s
+ t2=1662618831
+ echo '1662618831;1662618831;10;default;ext4;50;vacuum;0.027871;62768'
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RO`
+ '[' 50 == 50 ']'
+ continue
+ psql test -c checkpoint
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RW`
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/10/ext4/50/run-rw-1
++ date +%s
+ t1=1662618832
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=671793152
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=112386048
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=791614267
+ echo 'before;671793152;112386048;791614267'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 3600 20220907b/10/ext4/50/run-rw-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662618832.171874
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=0/27ECA2A0
+ pgbench -n -M prepared -N -j 4 -c 16 -T 3600 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/10/ext4/50/run-rw-1/pgbench_log.tgz pgbench_log.14287 pgbench_log.14287.1 pgbench_log.14287.2 pgbench_log.14287.3
+ rm -f pgbench_log.14287 pgbench_log.14287.1 pgbench_log.14287.2 pgbench_log.14287.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662618832.171874'
+ d=3601.267708
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''0/27ECA2A0'\'')'
+ w=21868351832
++ date +%s
+ t2=1662622433
++ cat 20220907b/10/ext4/50/run-rw-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=20181.005001
+ echo '1662618832;1662622433;10;default;ext4;50;rw;20181.005001;3601.267708;21868351832'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=4494991360
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=112386048
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=4614820667
+ echo 'after;4494991360;112386048;4614820667'
+ sleep 60
+ for scale in 50 250 1000
+ dropdb --if-exists test
+ createdb test
+ mkdir 20220907b/10/ext4/250
++ date +%s
+ t1=1662622494
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662622494.113541
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/3FA03170
+ pgbench -i -s 250 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662622494.113541'
+ d=38.077588
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/3FA03170'\'')'
+ w=3220063648
++ date +%s
+ t2=1662622532
+ echo '1662622494;1662622532;10;default;ext4;250;init;38.077588;3220063648'
++ date +%s
+ t1=1662622532
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662622532.199449
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/FF8E7710
+ vacuumdb --freeze --min-xid-age=1 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662622532.199449'
+ d=0.031016
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/FF8E7710'\'')'
+ w=84208
++ date +%s
+ t2=1662622532
+ echo '1662622532;1662622532;10;default;ext4;250;vacuum;0.031016;84208'
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RO`
+ '[' 250 == 50 ']'
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/10/ext4/250/run-ro-1
++ date +%s
+ t1=1662622532
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3358531584
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3927683899
+ echo 'before;3358531584;561651712;3927683899'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 900 20220907b/10/ext4/250/run-ro-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662622532.261644
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/FF8FC000
+ pgbench -n -M prepared -S -j 4 -c 16 -T 900 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/10/ext4/250/run-ro-1/pgbench_log.tgz pgbench_log.3925 pgbench_log.3925.1 pgbench_log.3925.2 pgbench_log.3925.3
+ rm -f pgbench_log.3925 pgbench_log.3925.1 pgbench_log.3925.2 pgbench_log.3925.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662622532.261644'
+ d=901.498091
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/FF8FC000'\'')'
+ w=504
++ date +%s
+ t2=1662623433
++ cat 20220907b/10/ext4/250/run-ro-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=101575.892835
+ echo '1662622532;1662623433;10;default;ext4;250;ro;101575.892835;901.498091;504'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3358531584
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3927683899
+ echo 'after;3358531584;561651712;3927683899'
+ sleep 60
+ psql test -c checkpoint
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RW`
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/10/ext4/250/run-rw-1
++ date +%s
+ t1=1662623493
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3358531584
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3927683899
+ echo 'before;3358531584;561651712;3927683899'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 3600 20220907b/10/ext4/250/run-rw-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662623493.815772
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/FF8FC2A8
+ pgbench -n -M prepared -N -j 4 -c 16 -T 3600 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/10/ext4/250/run-rw-1/pgbench_log.tgz pgbench_log.9115 pgbench_log.9115.1 pgbench_log.9115.2 pgbench_log.9115.3
+ rm -f pgbench_log.9115 pgbench_log.9115.1 pgbench_log.9115.2 pgbench_log.9115.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662623493.815772'
+ d=3600.978598
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/FF8FC2A8'\'')'
+ w=28862257200
++ date +%s
+ t2=1662627094
++ cat 20220907b/10/ext4/250/run-rw-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=14914.123750
+ echo '1662623493;1662627094;10;default;ext4;250;rw;14914.123750;3600.978598;28862257200'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=6277275648
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=6846427963
+ echo 'after;6277275648;561651712;6846427963'
+ sleep 60
+ for scale in 50 250 1000
+ dropdb --if-exists test
+ createdb test
+ mkdir 20220907b/10/ext4/1000
++ date +%s
+ t1=1662627155
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662627155.860083
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=C/B821AF90
+ pgbench -i -s 1000 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662627155.860083'
+ d=162.921837
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''C/B821AF90'\'')'
+ w=12880076408
++ date +%s
+ t2=1662627318
+ echo '1662627155;1662627318;10;default;ext4;1000;init;162.921837;12880076408'
++ date +%s
+ t1=1662627318
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662627318.790855
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=F/B7D80E08
+ vacuumdb --freeze --min-xid-age=1 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662627318.790855'
+ d=0.053369
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''F/B7D80E08'\'')'
+ w=184824
++ date +%s
+ t2=1662627318
+ echo '1662627318;1662627318;10;default;ext4;1000;vacuum;0.053369;184824'
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RO`
+ '[' 1000 == 50 ']'
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/10/ext4/1000/run-ro-1
++ date +%s
+ t1=1662627318
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=13433806848
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=15687791419
+ echo 'before;13433806848;2246483968;15687791419'
++ ps ax
++ grep collect-stats
++ wc -l
++ grep -v grep
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 900 20220907b/10/ext4/1000/run-ro-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662627318.885692
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=F/B7DAE000
+ pgbench -n -M prepared -S -j 4 -c 16 -T 900 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/10/ext4/1000/run-ro-1/pgbench_log.tgz pgbench_log.31138 pgbench_log.31138.1 pgbench_log.31138.2 pgbench_log.31138.3
+ rm -f pgbench_log.31138 pgbench_log.31138.1 pgbench_log.31138.2 pgbench_log.31138.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662627318.885692'
+ d=900.905898
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''F/B7DAE000'\'')'
+ w=4240
++ date +%s
+ t2=1662628219
++ cat 20220907b/10/ext4/1000/run-ro-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=58290.444857
+ echo '1662627318;1662628219;10;default;ext4;1000;ro;58290.444857;900.905898;4240'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=13433806848
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=15687791419
+ echo 'after;13433806848;2246483968;15687791419'
+ sleep 60
+ psql test -c checkpoint
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RW`
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/10/ext4/1000/run-rw-1
++ date +%s
+ t1=1662628279
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=13433806848
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=15687791419
+ echo 'before;13433806848;2246483968;15687791419'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 3600 20220907b/10/ext4/1000/run-rw-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662628279.859400
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=F/B7DAF178
+ pgbench -n -M prepared -N -j 4 -c 16 -T 3600 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/10/ext4/1000/run-rw-1/pgbench_log.tgz pgbench_log.4252 pgbench_log.4252.1 pgbench_log.4252.2 pgbench_log.4252.3
+ rm -f pgbench_log.4252 pgbench_log.4252.1 pgbench_log.4252.2 pgbench_log.4252.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662628279.859400'
+ d=3600.475002
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''F/B7DAF178'\'')'
+ w=59510541712
++ date +%s
+ t2=1662631880
++ grep 'without initial'
++ awk '{print $3}'
++ cat 20220907b/10/ext4/1000/run-rw-1/pgbench.log
+ tps=5900.675458
+ echo '1662628279;1662631880;10;default;ext4;1000;rw;5900.675458;3600.475002;59510541712'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=14766874624
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=2246483968
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=17020859195
+ echo 'after;14766874624;2246483968;17020859195'
+ sleep 60
+ pg_ctl -D /mnt/data/pgdata -l 20220907b/10/ext4/pg.log -w -m immediate -t 3600 stop
waiting for server to shut down.... done
server stopped
+ sudo umount /mnt/data
+ sudo mdadm --stop /dev/md0
mdadm: stopped /dev/md0
+ for level in 1 10 5 6
+ pgconf=default
+ for fs in xfs ext4
+ TESTDIR=20220907b/5/xfs
+ '[' -d 20220907b/5/xfs ']'
+ mkdir -p 20220907b/5/xfs
+ CSV='5;default;xfs'
+ echo '===== default 5 xfs ====='
===== default 5 xfs =====
+ l=5
+ '[' 5 == 0 ']'
+ '[' 5 == 1 ']'
+ '[' 5 == 10 ']'
+ '[' 5 == 5 ']'
+ d=5
+ sudo mdadm --zero-superblock --force /dev/sda1
+ sudo mdadm --zero-superblock --force /dev/sdb1
+ sudo mdadm --zero-superblock --force /dev/sdc1
+ sudo mdadm --zero-superblock --force /dev/sdd1
+ sudo mdadm --zero-superblock --force /dev/sde1
+ sudo mdadm --zero-superblock --force /dev/sdf1
+ sudo mdadm --create -R --verbose /dev/md0 --chunk=64K --level=5 --raid-devices=6 /dev/sda1 /dev/sdb1 /dev/sdc1 /dev/sdd1 /dev/sde1 /dev/sdf1
mdadm: layout defaults to left-symmetric
mdadm: layout defaults to left-symmetric
mdadm: size set to 97618176K
mdadm: Defaulting to version 1.2 metadata
mdadm: array /dev/md0 started.
+ stride=16
+ stripe_width=80
+ sleep 5
+ /bin/true
++ grep resync /proc/mdstat
++ wc -l
+ c=0
+ '[' 0 == 0 ']'
+ break
+ '[' xfs == ext4 ']'
+ sudo mkfs.xfs -f -d su=64k,sw=5 /dev/md0
meta-data=/dev/md0               isize=512    agcount=16, agsize=7626432 blks
         =                       sectsz=4096  attr=2, projid32bit=1
         =                       crc=1        finobt=1, sparse=1, rmapbt=0
         =                       reflink=1    bigtime=0 inobtcount=0
data     =                       bsize=4096   blocks=122022720, imaxpct=25
         =                       sunit=16     swidth=80 blks
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal log           bsize=4096   blocks=59581, version=2
         =                       sectsz=4096  sunit=1 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
+ sleep 5
+ sudo mount -o relatime /dev/md0 /mnt/data
+ sudo chown postgres:postgres /mnt/data
+ pg_ctl -D /mnt/data/pgdata init
+ cp postgresql-default.conf /mnt/data/pgdata/postgresql.conf
+ pg_ctl -D /mnt/data/pgdata -l 20220907b/5/xfs/pg.log -w start
waiting for server to start.... done
server started
+ ps ax
+ pg_config
+ psql postgres -c 'select * from pg_settings'
+ sudo mdadm --detail /dev/md0
+ for scale in 50 250 1000
+ dropdb --if-exists test
NOTICE:  database "test" does not exist, skipping
+ createdb test
+ mkdir 20220907b/5/xfs/50
++ date +%s
+ t1=1662631985
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662631985.780453
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=0/18810A8
+ pgbench -i -s 50 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662631985.780453'
+ d=24.561452
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''0/18810A8'\'')'
+ w=644061872
++ date +%s
+ t2=1662632010
+ echo '1662631985;1662632010;5;default;xfs;50;init;24.561452;644061872'
++ date +%s
+ t1=1662632010
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662632010.351885
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=0/27EBAB58
+ vacuumdb --freeze --min-xid-age=1 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662632010.351885'
+ d=0.030599
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''0/27EBAB58'\'')'
+ w=0
++ date +%s
+ t2=1662632010
+ echo '1662632010;1662632010;5;default;xfs;50;vacuum;0.030599;0'
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RO`
+ '[' 50 == 50 ']'
+ continue
+ psql test -c checkpoint
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RW`
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/5/xfs/50/run-rw-1
++ date +%s
+ t1=1662632021
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=671793152
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=112386048
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=791614267
+ echo 'before;671793152;112386048;791614267'
++ ps ax
++ grep collect-stats
++ wc -l
++ grep -v grep
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 3600 20220907b/5/xfs/50/run-rw-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662632021.829911
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=0/27ECA360
+ pgbench -n -M prepared -N -j 4 -c 16 -T 3600 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/5/xfs/50/run-rw-1/pgbench_log.tgz pgbench_log.26421 pgbench_log.26421.1 pgbench_log.26421.2 pgbench_log.26421.3
+ rm -f pgbench_log.26421 pgbench_log.26421.1 pgbench_log.26421.2 pgbench_log.26421.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662632021.829911'
+ d=3601.057904
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''0/27ECA360'\'')'
+ w=18756482904
++ date +%s
+ t2=1662635622
++ cat 20220907b/5/xfs/50/run-rw-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=16389.305743
+ echo '1662632021;1662635622;5;default;xfs;50;rw;16389.305743;3601.057904;18756482904'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3781992448
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=112386048
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3901829947
+ echo 'after;3781992448;112386048;3901829947'
+ sleep 60
+ for scale in 50 250 1000
+ dropdb --if-exists test
+ createdb test
+ mkdir 20220907b/5/xfs/250
++ date +%s
+ t1=1662635683
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662635683.522923
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=4/8624AF70
+ pgbench -i -s 250 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662635683.522923'
+ d=33.608097
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''4/8624AF70'\'')'
+ w=3220063712
++ date +%s
+ t2=1662635717
+ echo '1662635683;1662635717;5;default;xfs;250;init;33.608097;3220063712'
++ date +%s
+ t1=1662635717
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662635717.142326
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/4612F550
+ vacuumdb --freeze --min-xid-age=1 test
++ psql -t -A test -c 'select extract(epoch from now()) - 1662635717.142326'
+ d=0.039732
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/4612F550'\'')'
+ w=76464
++ date +%s
+ t2=1662635717
+ echo '1662635717;1662635717;5;default;xfs;250;vacuum;0.039732;76464'
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RO`
+ '[' 250 == 50 ']'
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/5/xfs/250/run-ro-1
++ date +%s
+ t1=1662635717
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3358531584
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3927683899
+ echo 'before;3358531584;561651712;3927683899'
++ ps ax
++ grep collect-stats
++ wc -l
++ grep -v grep
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 900 20220907b/5/xfs/250/run-ro-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662635717.222583
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/46142000
+ pgbench -n -M prepared -S -j 4 -c 16 -T 900 -l --sampling-rate=0.01 test
+ tar -czf 20220907b/5/xfs/250/run-ro-1/pgbench_log.tgz pgbench_log.16024 pgbench_log.16024.1 pgbench_log.16024.2 pgbench_log.16024.3
+ rm -f pgbench_log.16024 pgbench_log.16024.1 pgbench_log.16024.2 pgbench_log.16024.3
++ psql -t -A test -c 'select extract(epoch from now()) - 1662635717.222583'
+ d=901.471883
++ psql -t -A test -c 'select pg_wal_lsn_diff(pg_current_wal_lsn(), '\''5/46142000'\'')'
+ w=8248
++ date +%s
+ t2=1662636618
++ cat 20220907b/5/xfs/250/run-ro-1/pgbench.log
++ grep 'without initial'
++ awk '{print $3}'
+ tps=99637.839181
+ echo '1662635717;1662636618;5;default;xfs;250;ro;99637.839181;901.471883;8248'
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3358531584
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3927683899
+ echo 'after;3358531584;561651712;3927683899'
+ sleep 60
+ psql test -c checkpoint
++ seq -s ' ' 1 1
+ for r in `seq -s ' ' 1 $RUNS_RW`
+ rm -f 'pgbench_log.*'
+ mkdir 20220907b/5/xfs/250/run-rw-1
++ date +%s
+ t1=1662636678
++ psql -t -A test -c 'select sum(pg_table_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ st=3358531584
++ psql -t -A test -c 'select sum(pg_indexes_size(oid)) from pg_class where relnamespace = 2200 and relkind = '\''r'\'''
+ si=561651712
++ psql -t -A test -c 'select pg_database_size('\''test'\'')'
+ sd=3927683899
+ echo 'before;3358531584;561651712;3927683899'
++ ps ax
++ grep collect-stats
++ grep -v grep
++ wc -l
+ c=0
+ '[' 0 '!=' 0 ']'
+ ./collect-stats.sh 3600 20220907b/5/xfs/250/run-rw-1
++ psql -t -A test -c 'select extract(epoch from now())'
+ s=1662636678.750707
++ psql -t -A test -c 'select pg_current_wal_lsn()'
+ w=5/461440E8
+ pgbench -n -M prepared -N -j 4 -c 16 -T 3600 -l --sampling-rate=0.01 test
